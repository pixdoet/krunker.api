/*! 1/3/2020 5:22AM
 * Copyright (C) Hoodgail.Benjamin - All Rights Unreserved
 * Authorized copying of this file, via any medium is strictly Allowed
 * Proprietary and Public
 * Written by Hoodgail Benjamin <hoodgail.ben@gmail.com>
 * Discord - <Hoodgail#5408>
 */
//but please give me some credits... cuz imma be doing some big updates to this
//i got big plans hehe
//////////////////////Code begins here
var e,t,n,o,i,r,a,s,l,d,c,u,m,h,p,f,g,w,E,b,T,R,H,y,v,D,x,S,M,L,C,P,j,z,B,W,A,k,F,G,q,O,U,_,I,N,V,J,Z,K="1.0.0",Q=(z=new URLSearchParams(window.location.search)).get("m"),X=z.get("t"),Y=z.get("h"),ee=z.get("pul"),te=z.get("skinp"),ne=z.get("editor"),oe=z.get("fr"),ie=z.get("frt"),re=z.get("movT"),ae=z.get("glow"),se=z.get("ngui"),le=z.get("class"),de=z.get("backgroundcol"),ce=z.get("s"),ue=[],me={x:0,y:0};function he(){return null==ae?null:16777215}function pe(){return null==oe||null==oe?1:oe}function fe(){return null==ie||null==ie?1:ie}function ge(){return null==de?"#212121":"default"==de?"#212121":"#"+de}function we(){return ce}function Ee(){c.remove(c.getObjectByName("objg"))}function be(){camera.aspect=window.innerWidth/window.innerHeight,h.setSize(window.innerWidth,window.innerHeight)}function Te(){return ae?E:null}d=null==ae?{exposure:0,bloomStrength:0,bloomThreshold:0,bloomRadius:0}:{exposure:1,bloomStrength:.82,bloomThreshold:.32,bloomRadius:0},$("body").css({background:`${ge()}`}),Detector.webgl||Detector.addGetWebGLMessage(),c=new THREE.Scene,camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),camera.position.z=6.471,camera.far=1e5,u=new THREE.AmbientLight(13421772,.4),c.add(u),m=new THREE.PointLight(16777215,.8),camera.add(m),c.add(camera),(h=new THREE.WebGLRenderer({preserveDrawingBuffer:!1,precision:"mediump",powerPreference:"high-performance",alpha:!0,antialias:!1})).setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.setClearColor(0,0),h.autoClear=!0,(p=document.getElementById("ThreeJS")).appendChild(h.domElement),controls=new THREE.OrbitControls(camera,h.domElement),controls.enableDamping=!0,controls.dampingFactor=.25,controls.enableZoom=!0,window.addEventListener("resize",be,!1),(f=new THREE.LoadingManager(ve)).onProgress=function(e,t,n){},g=new THREE.Clock,w=(new THREE.TextureLoader).load(getTex(te)),E=(new THREE.TextureLoader).load(getTexGlow(te)),b=new xe(w,pe(),1,16,fe()),eannie=new xe(E,pe(),1,16,fe()),T=new THREE.RenderPass(c,camera),(R=new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85)).threshold=d.bloomThreshold,R.strength=d.bloomStrength,R.radius=d.bloomRadius,composer=new THREE.EffectComposer(h),composer.addPass(T),composer.addPass(R),camera.add(m);const Re=document.querySelector("body");for(H=new THREE.BufferGeometry,y=[],D="textures/",x=".png",S=(v=new THREE.TextureLoader).load(D+"p_1"+x),M=v.load(D+"p_2"+x),L=v.load(D+"p_3"+x),C=v.load(D+"p_1"+x),P=v.load(D+"p_1"+x),j=0;j<1e3;j++){z=2e3*Math.random()-1e3,B=2e3*Math.random()-1e3,W=2e3*Math.random()-1e3,y.push(z,B,W)}for(H.setAttribute("position",new THREE.Float32BufferAttribute(y,3)),n=[[[1,.2,.5],M,20],[[.95,.1,.5],L,15],[[.9,.05,.5],S,10],[[.85,0,.5],P,8],[[.8,0,.5],C,5]],j=0;j<n.length;j++){A=n[j][0],k=n[j][1],F=n[j][2],ue[j]=new THREE.PointsMaterial({size:F,map:k,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0}),ue[j].color.setHSL(A[0],A[1],A[2]),(G=new THREE.Points(H,ue[j])).rotation.x=6*Math.random(),G.rotation.y=6*Math.random(),G.rotation.z=6*Math.random(),c.add(G)}function He(e){e.lengthComputable&&(e.loaded,e.total)}function ye(){al("err")}function ve(){object.traverse(function(e){e.isMesh&&(e.material=O)});var e=we();object.position.y=0,object.position.x=0,object.scale.y=e,object.scale.x=e,object.scale.z=e,object.name="objg",c.add(object)}function De(){var e,t,o,i,r,a,s;for(requestAnimationFrame(De),e=g.getDelta(),re&&(w.offset.x+=.03),b.update(1e3*e),t=5e-5*Date.now(),o=5e-11*Date.now(),h.render(c,camera),i=0;i<c.children.length;i++){(r=c.children[i])instanceof THREE.Points&&(r.rotation.y=t*(i<4?i+1:-(i+1)),r.position.x=o*(i<4?i+1:-(i+1)),r.position.y=o*(i<4?i+1:-(i+1)))}for(i=0;i<ue.length;i++){s=360*((a=n[i][0])[0]+t)%360/360,ue[i].color.setHSL(s,a[1],a[2])}}function xe(e,t,n,o,i){this.tilesHorizontal=t,this.tilesVertical=n,this.numberOfTiles=o,e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=i,this.currentDisplayTime=0,this.currentTile=0,this.update=function(t){var n,o;for(this.currentDisplayTime+=t;this.currentDisplayTime>this.tileDisplayDuration;){this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,this.currentTile==this.numberOfTiles&&(this.currentTile=0),n=this.currentTile%this.tilesHorizontal,e.offset.x=n/this.tilesHorizontal,o=Math.floor(this.currentTile/this.tilesHorizontal),e.offset.y=o/this.tilesVertical}}}function Se(){ne&&$("#editor").css({display:"block"});$("#editor").append("\n\n  ")}function Me(e){var t,n=new FileReader;return n.readAsDataURL(e),n.onload=function(){t=n.result},n.onerror=function(e){t="[undefined]"},t}function Le(){var e=document.querySelector('input[name="map"]').files[0],t=document.querySelector('input[name="emissiveMap"]').files[0];bti=Me(e),bte=Me(t)}q=new THREE.OBJLoader(f),O=new THREE.MeshLambertMaterial({map:w,emissive:he(),emissiveMap:Te(),side:THREE.DoubleSide,transparent:!0,flatShading:!1,reflectivity:40,emissiveIntensity:1}),q.load(getskinModel(le),function(e){object=e},He,ye),De(),_={texture:!0},I={"Rotate weapon randomly":function(){setInterval(function(){var e=5e-5*Date.now();object.rotation.y=e*(j<4?j+1:-(j+1))},1e-6)}},(U=new dat.GUI).add(_,"texture").onChange(function(e){for(var t=0;t<ue.length;t++){ue[t].map=!0===e?n[t][1]:null,ue[t].needsUpdate=!0}}),U.add(I,"Rotate weapon randomly").onChange(function(e){}),U.open(),(N=U.addFolder("Bloom Setting")).add(d,"bloomStrength",0,10).step(.01).onChange(function(e){R.strength=Number(e)}),N.add(d,"bloomThreshold",0,1).step(.01).onChange(function(e){R.threshold=Number(e)}),N.add(d,"bloomRadius",0,2).step(.01).onChange(function(e){R.radius=Number(e)}),N.open(),V=function(){},J=function(){h.render(c,camera)},(Z=function(){requestAnimationFrame(Z),V(),J(),composer.render()})();